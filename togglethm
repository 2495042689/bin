#! /usr/bin/env python3

import os
import sys
import neovim
from glob import glob
from os.path import join

path=join(os.getenv("HOME"), ".bgtype")
bgtype = None
preset = None

with open(path, "r") as f:
    bgtype = f.read()

if bgtype == "dark":
    bgtype = "light"
    preset = "Raven Light"
elif bgtype == "light":
    bgtype = "dark"
    preset = "Raven Dark"
else:
    print("Invalid background type read from {}.", file=sys.stderr)
    sys.exit(1)

with open(path, "w") as f:
    f.write(bgtype)

for pt in glob("/dev/ttys???"):
    with open(pt, "w") as f:
        f.write("\033]1337;SetColors=preset={}\a".format(preset))

for sp in glob("{}*/0".format(join(os.getenv("TMPDIR"), "nvim"))):
    try:
        nvim = neovim.attach("socket", path=sp)
        nvim.command("colorscheme raven-{}".format(bgtype))
    except:
        pass
