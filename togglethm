#! /bin/sh

PATH="/usr/local/bin:${PATH}"

if [ $# -gt 0 ] ; then
    bgtype=$1
else
	bgtype=$(cat "$HOME"/.conditions)
    case "$bgtype" in
        Dark)
            bgtype=Light
            ;;
        Light)
            bgtype=Dark
            ;;
    esac
fi

printf "%s" "$bgtype" > "$HOME"/.conditions

for tty in $(tmux list-clients -F '#{client_tty}') ; do
	printf "\033]50;SetProfile=%s\a" "$bgtype" > "$tty"
done

vim --serverlist | xargs -I % vim --servername % --remote-send ":source ~/.vimrc<cr>"
