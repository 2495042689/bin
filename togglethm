#! /usr/bin/env python3

import os
import sys
import neovim
from glob import glob
from os.path import join

path=join(os.getenv("HOME"), ".bgtype")
bgtype = None

with open(path, "r") as f:
    bgtype = f.read()

if bgtype == "dark":
    bgtype = "light"
elif bgtype == "light":
    bgtype = "dark"
else:
    print("Invalid background type read from {}.", file=sys.stderr)
    sys.exit(1)

with open(path, "w") as f:
    f.write(bgtype)

for pt in glob("/dev/ttys???"):
    with open(pt, "w") as f:
        f.write("\x1b]50;SetProfile=home-{}\x07".format(bgtype))

for sp in glob("{}*/0".format(join(os.getenv("TMPDIR"), "nvim"))):
    nvim = neovim.attach("socket", path=sp)
    nvim.command("colorscheme bubblegum-256-{}".format(bgtype))
