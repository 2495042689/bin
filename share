#! /bin/sh

src=//livebox/DATA
dst=/tmp/data
trg=$(hostname -s)
cmd=$1
shift

if [ ! -d "$dst" ] ; then
	mkdir "$dst" || exit 1
	mount -t smbfs "$src" "$dst"
fi


case "$cmd" in
	ls)
		pax -f "$dst/${1:-$trg}.pax" ;;
	list)
		pax -v -f "$dst/${1:-$trg}.pax" ;;
	pack)
		opt="-w"
		[ -e "$dst/${trg}.pax" ] && opt="$opt -au"
		pax -v $opt -f "$dst/${trg}.pax" "$@" ;;
	unpack)
		arg=$1
		shift
		pax -v -ru -f "$dst/${arg}.pax" "$@" ;;
	destroy)
		rm "$dst/${1:-$trg}.pax" ;;
	connect)
		mount -t smbfs "$src" "$dst" ;;
	disconnect)
		umount "$dst" ;;
	status)
		mount | grep "$src" 2>&1 > /dev/null && echo "up" || echo "down" ;;
esac
